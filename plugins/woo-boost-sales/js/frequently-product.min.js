jQuery(document).ready(function(t){"use strict";let e,i=wbs_frequently_product_params.frequently_product_add_to_cart_text;function s(i){e=0;let s=i.find(".vi-wbs-frequently-product-item-check"),r=i.find(".vi-wbs-frequently-sum-price"),c=i.find(".vi-wbs-frequently-sum-price-show-discount"),n=i.find(".vi-wbs-frequently-sum-price-discount-value"),l=parseFloat(r.data("discounted_amount")),u=parseFloat(r.data("discounted_price")),d=r.data("dynamic_price"),f=parseInt(r.data("saved_type")),p=r.data("discount_type"),m=parseFloat(r.data("discount_amount")),_=r.find(".vi-wbs-frequently-sum-price-value"),b=a(s),v=b;i.hasClass("vi-wbs-frequently-products-add-bundle")&&woocommerce_boost_sales_params.crosssell_enable&&e===i.find(".vi-wbs-frequently-product-item-check").length&&(e=0,v=b=a(s,!0),d?m>0&&((b="percent"===p?v*(1-(m/=100)):v-m)<0&&(b=0),l=v-(b=parseFloat(o(b,void 0,".","")))):u<v&&(l=v-u)),r.data("total_price",b);let w=woocommerce_boost_sales_params.modal_price.replace(o(1),o(b));_.html(w),e===i.find(".vi-wbs-frequently-product-item-check").length&&l>0?(0===f?n.html(woocommerce_boost_sales_params.modal_price.replace(o(1),o(l))):1===f&&n.html(`${o(100*l/v,0)}%`),t(".vi-wbs-frequently-sum-price-show-discount-origin").html(woocommerce_boost_sales_params.modal_price.replace(o(1),o(v))),d&&t(".vi-wbs-frequently-sum-price-show-discount-current").html(w),_.hide(),c.fadeIn(200),i.addClass("vi-wbs-frequently-products-bundle-offer")):(c.hide(),_.fadeIn(200),i.removeClass("vi-wbs-frequently-products-bundle-offer"))}function a(i,s=!1){let a=0;return i.map(function(){let i=t(this),r=i.closest(".vi-wbs-frequently-product-item");if(i.prop("checked")){e++;let t=s?parseInt(r.data("item_quantity")):1;a+=t*parseFloat(r.data("item_price"))}}),a}t(document).on("click",function(){t(".vi-wbs-show-select").removeClass("vi-wbs-show-select")}),t(document).on("click",".vi-wbs-frequently-product-item-attributes",function(e){e.stopPropagation();let i=t(this).closest(".vi-wbs-frequently-product-item");t(".vi-wbs-frequently-product-item").not(i).removeClass("vi-wbs-show-select"),i.toggleClass("vi-wbs-show-select")}),t(document).on("click",".vi-wbs-frequently-product-item-attributes-select-modal",function(t){t.stopPropagation()}),t(".vi-wbs-frequently-product-item-attributes-select-container").map(function(){let e=t(this),i=e.closest(".vi-wbs-frequently-product-item"),a=e.closest(".vi-wbs-frequently-products-container"),r=i.find("img").eq(0);e.wc_variation_form(),e.on("found_variation",function(o,c){if(c.attributes&&c.is_in_stock&&c.is_purchasable){let o=[],n={};e.find(".vi-wbs-frequently-product-item-attributes-select-item").map(function(){let e=t(this),i=e.find(":selected");n[e.data("attribute_name")]=e.val(),o.push(i.html())});let l=o.join(", ");i.data("variation_id",c.variation_id),i.data("variation_attributes",n),c.price_html&&(i.data("item_price",parseFloat(c.display_price)),i.find(".vi-wbs-frequently-product-item-price").html(c.price_html),i.find(".vi-wbs-frequently-product-item-price .price").removeClass("price")),i.find(".vi-wbs-frequently-product-item-attributes-value").html(l).attr("title",l);let u=c.image;u.hasOwnProperty("srcset")&&u.srcset&&r.attr("srcset",u.srcset),u.hasOwnProperty("thumb_src")&&u.thumb_src?r.attr("src",u.thumb_src):u.hasOwnProperty("url")&&u.url&&r.attr("src",u.url),s(a)}})}),t(document).on("change",".vi-wbs-frequently-product-item-attributes-select-item",function(){t(this).closest(".vi-wbs-frequently-product-item-attributes-select-container").find(".vi-wbs-fp-variation").map(function(){let e=t(this),i=e.find(".vi-wbs-frequently-product-item-attributes-select-item"),s=i.val();e.find(".vi-wbs-fp-value-option").map(function(){let e=t(this),s=i.find(`option[value="${t.escapeSelector(e.data("wbs_fp_option"))}"]`);s.length>0&&!s.prop("disabled")?e.removeClass("vi-wbs-fp-value-disabled"):e.addClass("vi-wbs-fp-value-disabled")}),e.find(".vi-wbs-fp-value-selected").removeClass("vi-wbs-fp-value-selected"),s&&e.find(`.vi-wbs-fp-value-option[data-wbs_fp_option="${t.escapeSelector(s)}"]`).addClass("vi-wbs-fp-value-selected")})}),t(document).on("click",".vi-wbs-fp-value-option",function(e){let i=t(this);if(!i.hasClass("vi-wbs-fp-value-disabled")){let t=i.closest(".vi-wbs-fp-value");i.hasClass("vi-wbs-fp-value-selected")?t.find(".vi-wbs-frequently-product-item-attributes-select-item").val("").trigger("change"):t.find(".vi-wbs-frequently-product-item-attributes-select-item").val(i.data("wbs_fp_option")).trigger("change")}}),t(".vi-wbs-frequently-product-item-attributes-select-item").map(function(){t(this).trigger("change")}),t(".single_variation_wrap").on("show_variation",function(e,i){if(i.attributes&&i.is_in_stock&&i.is_purchasable){let e=t(this).closest(".variations_form ");t(`.vi-wbs-frequently-product-item[data-product_id="${e.data("product_id")}"]`).map(function(){let e=t(this);if(i.variation_id&&e.data("variation_id")!=i.variation_id){e.find("select.vi-wbs-frequently-product-item-attributes-select-item").val("").trigger("change");for(let t in i.attributes)e.find(`select.vi-wbs-frequently-product-item-attributes-select-item[data-attribute_name="${t}"]`).val(i.attributes[t]).trigger("change")}})}}),t(".vi-wbs-frequently-products-container").map(function(){let e=t(this);e.data("wbs_fp_shortcode").ajax_load&&function(e){t.ajax({url:wbs_frequently_product_params.url,type:"get",dataType:"json",data:{action:"vi_wbs_frequently_product_shortcode_ajax_load",wbs_fp_shortcode:JSON.stringify(e.data("wbs_fp_shortcode")),is_product:wbs_frequently_product_params.is_product,language:wbs_frequently_product_params.language},beforeSend:function(){e.addClass("vi-wbs-frequently-products-ajax-load")},error:function(t){},success:function(i){if("success"===i.status&&i.data){let s=t(i.data);e.replaceWith(s),s.find(".vi-wbs-frequently-product-item-attributes-select-item").map(function(){t(this).trigger("change")})}else e.remove()},complete:function(){e.removeClass("vi-wbs-frequently-products-ajax-load")}})}(e)}),t(document).on("click",".vi-wbs-frequently-product-item-check",function(){let a=t(this).closest(".vi-wbs-frequently-products-container");if(0===a.find(".vi-wbs-frequently-product-item-check:checked").length)return!1;let r=a.find(".vi-wbs-frequently-add-to-cart-button");if(s(a),!(e>0))return!1;r.html(i.replace("{number_of_items}",e))});let r=!1;function o(t,e,i,s){void 0===e&&(e=wbs_frequently_product_params.decimals),void 0===i&&(i=wbs_frequently_product_params.decimal_separator),void 0===s&&(s=wbs_frequently_product_params.thousand_separator);let a=(t=t.toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e})).split(".");return t=a[0].split(",").join(s),2===a.length&&(t=t+i+a[1]),t}t(document).on("click",".vi-wbs-frequently-add-to-cart-button",function(e){if(e.preventDefault(),!r){r=!0;let e=t(this),i=e.closest(".vi-wbs-frequently-products-container"),s=i.find(".vi-wbs-frequently-add-to-cart-message"),a=i.data("wbs_fp_shortcode"),o=[];i.find(".vi-wbs-frequently-product-item").map(function(){let e=t(this);e.find(".vi-wbs-frequently-product-item-check").prop("checked")&&o.push({product_id:e.data("product_id"),variation_id:e.data("variation_id"),variation_attributes:e.data("variation_attributes")})});let c={action:"vi_wbs_frequently_product_add_to_cart",wbs_fp_shortcode:JSON.stringify(a),data:o,quantity:1,is_cart:wbs_frequently_product_params.is_cart,is_checkout:wbs_frequently_product_params.is_checkout},n=i.find(".vi-wbs-frequently-product-item-attributes-select-item").serializeArray();n.length>0&&n.forEach(function(t){c[t.name]=t.value}),t.ajax({url:wbs_frequently_product_params.url,type:"post",dataType:"json",data:c,beforeSend:function(){e.addClass("loading"),s.html(""),i.addClass("vi-wbs-frequently-products-ajax-load")},error:function(t){s.html('<div class="vi-wbs-frequently-add-to-cart-message-error">An error occurs. Please try again later.</div>')},success:function(e){if("success"===e.status){if(e.after_atc)window.location.href=e.after_atc;else if(wbs_frequently_product_params.is_cart||wbs_frequently_product_params.is_checkout)window.location.href=window.location.href;else{t("body").trigger("wc_fragment_refresh");let e=i.closest(".woocommerce-boost-sales");e.length>0?setTimeout(function(){e.fadeOut(200),jQuery("html").removeClass("wbs-html-overflow")},3e3):"hide"===a.after_atc&&i.fadeOut(5e3)}1!=woocommerce_boost_sales_params.side_cart_auto_open||jQuery(".xoo-wsc-modal").hasClass("xoo-wsc-active")||jQuery(".xoo-wsc-basket").click(),jQuery("#nm-menu-cart-btn").click()}s.html(`<div class="vi-wbs-frequently-add-to-cart-message-${e.status}">${e.message}</div>`)},complete:function(){e.removeClass("loading"),r=!1,i.removeClass("vi-wbs-frequently-products-ajax-load")}})}})});